(function(e){function t(t){for(var r,o,s=t[0],c=t[1],l=t[2],u=0,d=[];u<s.length;u++)o=s[u],i[o]&&d.push(i[o][0]),i[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);f&&f(t);while(d.length)d.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,o=1;o<n.length;o++){var s=n[o];0!==i[s]&&(r=!1)}r&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},o={app:0},i={app:0},a=[];function s(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-002e499f":"d4cf48be","chunk-dbba60c4":"c36f5050"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-002e499f":1,"chunk-dbba60c4":1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=new Promise(function(t,n){for(var r="css/"+({}[e]||e)+"."+{"chunk-002e499f":"6ae90ab5","chunk-dbba60c4":"a99cfebc"}[e]+".css",i=c.p+r,a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var l=a[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===r||u===i))return t()}var d=document.getElementsByTagName("style");for(s=0;s<d.length;s++){l=d[s],u=l.getAttribute("data-href");if(u===r||u===i)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||i,a=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=r,delete o[e],f.parentNode.removeChild(f),n(a)},f.href=i;var h=document.getElementsByTagName("head")[0];h.appendChild(f)}).then(function(){o[e]=0}));var r=i[e];if(0!==r)if(r)t.push(r[2]);else{var a=new Promise(function(t,n){r=i[e]=[t,n]});t.push(r[2]=a);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(e),l=function(t){u.onerror=u.onload=null,clearTimeout(d);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+r+": "+o+")");a.type=r,a.request=o,n[1](a)}i[e]=void 0}};var d=setTimeout(function(){l({type:"timeout",target:u})},12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var f=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0e6c":function(e,t,n){"use strict";var r=n("103e"),o=n.n(r);o.a},"103e":function(e,t,n){},"1b8f":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);var r=n("8bbf"),o=n.n(r),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("keep-alive",[n("router-view")],1)],1)},a=[],s=n("2877"),c={},l=Object(s["a"])(c,i,a,!1,null,null,null),u=l.exports,d=n("6389"),f=n.n(d),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("SidebarBookShelf"),n("BookShelf")],1)},p=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"book-shelf-wrapper"},[e._l(e.bookList,function(t,r){return n("div",{key:r,staticClass:"book-item",on:{click:function(n){return e.jumpTo(t.bookname)}}},[n("div",{staticClass:"book-cover",domProps:{innerHTML:e._s(t.cover)}}),n("div",{staticClass:"book-name"},[e._v(e._s(t.bookname))])])}),n("div",{staticClass:"add-book",on:{click:function(t){return e.addBook()}}},[n("div",{staticClass:"add-book-img"},[n("div",{staticClass:"add-book-img-svg"},[n("svg",{staticClass:"icon",attrs:{t:"1563699280848",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9282","data-spm-anchor-id":"a313x.7781069.0.i4",width:"200",height:"200"}},[n("path",{attrs:{d:"M903 558.2c-13.3 0-24 10.7-24 24v216.7c0 16.8-16.1 30.4-36 30.4H181c-19.9 0-36-13.6-36-30.4V561.3c0-13.3-10.7-24-24-24s-24 10.7-24 24v237.6c0 43.2 37.7 78.4 84 78.4h662c46.3 0 84-35.2 84-78.4V582.2c0-13.3-10.7-24-24-24z",fill:"#AAAAAA","p-id":"9283"}}),n("path",{attrs:{d:"M334.5 298.6l160.9-145.3c1.1-1 2.3-1.9 3.6-2.7h0.1c0.6-0.4 1.2-0.7 1.9-1 0 0 0.1 0 0.1-0.1 0.6-0.3 1.3-0.6 1.9-0.8 0 0 0.1 0 0.1-0.1 0.6-0.2 1.3-0.4 1.9-0.6h0.2c0.6-0.2 1.3-0.3 1.9-0.4h0.2c0.6-0.1 1.3-0.2 2-0.3h0.2c0.7-0.1 1.3-0.1 2-0.1h0.2c0.6 0 1.3 0 1.9 0.1h0.3c0.7 0.1 1.3 0.2 2 0.3h0.2c0.7 0.1 1.3 0.3 2 0.5h0.1c0.7 0.2 1.3 0.4 2 0.7h0.1c0.7 0.3 1.3 0.5 2 0.9 1.3 0.7 2.6 1.4 3.8 2.3 0.6 0.5 1.2 0.9 1.7 1.4l158.6 145.3c9.8 9 10.4 24.1 1.5 33.9-9 9.8-24.1 10.4-33.9 1.5L535.1 225.3l-3 467.2c-0.1 13.2-10.8 23.8-24 23.8h-0.2c-13.3-0.1-23.9-10.9-23.8-24.2l3-466.7-120.4 108.8c-9.8 8.9-25 8.1-33.9-1.7-8.9-9.8-8.1-25 1.7-33.9z",fill:"#AAAAAA","p-id":"9284"}})])])]),n("div",{staticClass:"add-book-text"},[e._v("添加图书")]),n("input",{ref:"input",staticClass:"input",attrs:{type:"file"},on:{change:function(t){return e.loadFile(t)}}})])],2)},m=[],v=(n("28a5"),n("a481"),n("1da1"));const g=new DOMParser,y=new JSZip;let k,w,S,x,j,C=[],A=[];const O=function(e){let t=e.split(".");return t[t.length-1]},_=function(e){return""===S?e:S+"/"+e},N=function(){var e=Object(v["a"])(function*(e){return yield y.loadAsync(e)});return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(v["a"])(function*(e){return k=yield N(e),yield k.files["META-INF/container.xml"].async("string")});return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(v["a"])(function*(e){let t=yield B(e),n=g.parseFromString(t,"text/xml");return w=n.getElementsByTagName("rootfile")[0].getAttribute("full-path"),S="content.opf"===w.split("/")[0]?"":w.split("/")[0],yield k.files[w].async("string")});return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(v["a"])(function*(e){let t=yield L(e);x=g.parseFromString(t,"text/xml"),j=x.getElementsByTagName("spine")[0].children;let n=[];for(let r=0;r<j.length;r++){let e=j[r].getAttribute("idref"),t=x.getElementById(e).getAttribute("href");n.push(t)}return n});return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(v["a"])(function*(e){let t=yield T(e),n=[],r=t.length;for(let o=0;o<r;o++){const e=t[o];let r=_(e),i=yield k.files[r].async("string");C.push(r),n.push(i)}return n});return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(v["a"])(function*(e){$();const t=function(){var e=Object(v["a"])(function*(e){let t=g.parseFromString(yield e,"text/html"),n=t.getElementsByTagName("image");for(let o=0;o<n.length;o++){const e=n[o];let t=e.getAttribute("xlink:href"),r=O(t),i=_(t).replace(/\/\.\.\//,"/"),a=yield k.files[i].async("base64");e.setAttribute("xlink:href","data:image/"+r+";base64,"+a)}let r=t.getElementsByTagName("img");for(let o=0;o<r.length;o++){const e=r[o];let t=e.getAttribute("src"),n=O(t),i=_(t).replace(/\/\.\.\//,"/"),a=yield k.files[i].async("base64");e.setAttribute("src","data:image/"+n+";base64,"+a)}return t});return function(t){return e.apply(this,arguments)}}();let n=yield E(e),r=[],o=n.length;for(let l=0;l<o;l++){const e=n[l];let o=yield t(e);r.push({relativeurl:C[l],content:`${o.querySelector("body").innerHTML}`})}let i=_("toc.ncx"),a=yield k.files[i].async("string"),s=g.parseFromString(a,"text/xml");A=s.querySelectorAll("navPoint");let c=[];for(let l=0;l<A.length;l++){const e=`${A[l].querySelector("text").innerHTML}`,t=_(`${A[l].querySelector("content").getAttribute("src")}`).split("#")[0];c.push({secName:e,sectionUrl:t})}return[r,c]});return function(t){return e.apply(this,arguments)}}(),$=()=>{k=void 0,w=void 0,S=void 0,x=void 0,j=void 0,C=[]};var D=P,M=n("5a72"),q={clearLocal(){localStorage.clear()},getLocal(){let e=localStorage.getItem("books");return e?JSON.parse(e):[]},saveLocal(e){this.clearLocal(),localStorage.setItem("books",JSON.stringify(e))}};const F={methods:{jumpTo(e){this.$router.push({name:"reader",params:{bookname:e},query:{section:1}})}}};var I={mixins:[F],data(){return{currBlob:"",currDbName:"",booksName:[]}},computed:{bookList(){return this.$store.state.booklist}},methods:{addBook(){this.$refs.input.click()},loadFile(e){if(e.target.files.length<1)return;this.currBlob=e.target.files[0],this.currDbName=this.currBlob.name.split(".")[0];let t=Object(M["b"])(this.currDbName);this.booksName.push(this.currDbName),t.then(e=>{"first-open"===e?D(this.currBlob).then(e=>{let t=e[1];M["a"].add(this.currDbName,t,0);let n=e[0],r=n.length;for(let o=0;o<r;o++){let e=n[o];M["a"].add(this.currDbName,e,o+1)}}).then(()=>{this.getCover(),this.localSave()}):"open"===e&&(this.getCover(),this.localSave())})},getCover(e){let t;t=void 0===e?[this.currDbName]:e;let n=1;M["a"].read(t,n).then(e=>{let n={};n.bookname=t,n.cover=e.content,this.$store.commit("addbook",n)})},localSave(){q.saveLocal(this.booksName)}},mounted(){let e=q.getLocal();this.booksName=e,e.length>=1&&e.map(e=>{Object(M["b"])(e).then(()=>{this.getCover(e)})})}},H=I,J=(n("8c34"),Object(s["a"])(H,b,m,!1,null,null,null)),V=J.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("aside",{staticClass:"sidebar"},[n("header",{staticClass:"sidebar-item-title",on:{click:function(t){return t.target!==t.currentTarget?null:e.show(1)}}},[e._v("书架")]),n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.isShow,expression:"isShow === 1"}],staticClass:"book-shelf-small"},e._l(e.bookList,function(t,r){return n("div",{key:r,staticClass:"sidebar-item-book"},[n("div",{staticClass:"sidebar-book-name sidebar-collapse-item",on:{click:function(n){return e.jumpTo(t.bookname)}}},[e._v(e._s(t.bookname))])])}),0)])},z=[],R=n("d4bd"),K={mixins:[F,R["a"]],computed:{bookList(){return this.$store.state.booklist}}},Z=K,G=(n("d5f6"),Object(s["a"])(Z,U,z,!1,null,null,null)),Q=G.exports,W={name:"home",components:{BookShelf:V,SidebarBookShelf:Q}},X=W,Y=(n("0e6c"),Object(s["a"])(X,h,p,!1,null,null,null)),ee=Y.exports;o.a.use(f.a);var te=new f.a({routes:[{path:"/",name:"home",component:ee},{path:"/reader/:bookname",name:"reader",component:()=>n.e("chunk-002e499f").then(n.bind(null,"968f"))}],scrollBehavior(e,t,n){return n||{x:0,y:0}}}),ne=n("5880"),re=n.n(ne);o.a.use(re.a);var oe=new re.a.Store({state:{booklist:[],secList:[],readerCurrContentUrl:""},mutations:{addbook(e,t){e.booklist.push(t)},addsec(e,t){e.secList.push(t)},changeurl(e,t){e.readerCurrContentUrl=t}},actions:{}});o.a.config.productionTip=!1,new o.a({router:te,store:oe,render:e=>e(u)}).$mount("#app")},5880:function(e,t){e.exports=Vuex},"5a72":function(e,t,n){"use strict";let r;n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i});const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise((n,o)=>{var i=window.indexedDB.open(e,t);i.onerror=function(e){o("数据库打开失败")},i.onsuccess=function(e){r=i.result,n("open")},i.onupgradeneeded=function(t){r=t.target.result;var o=r.createObjectStore(e,{keyPath:"id"});o.createIndex("relativeurl","relativeurl",{unique:!0}),o.createIndex("section","section",{unique:!0}),o.createIndex("content","content"),n("first-open")}})},i={add(e,t,n){return new Promise((o,i)=>{let a=r.transaction([e],"readwrite"),s=a.objectStore(e);t.id=n,t.section=n;let c=s.add(t);c.onsuccess=function(e){o()},c.onerror=function(e){i()}})},read(e,t){return new Promise((n,o)=>{let i=r.transaction([e]),a=i.objectStore(e),s=a.get(t);s.onsuccess=function(e){n(e.target.result)},s.onerror=function(e){o("读取失败")}})},indexRead(e,t){return new Promise((n,o)=>{let i=r.transaction([e]),a=i.objectStore(e),s=a.index("relativeurl"),c=s.get(t);c.onsuccess=function(e){n(e.target.result)},c.onerror=function(e){o("读取失败")}})}}},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"8c34":function(e,t,n){"use strict";var r=n("1b8f"),o=n.n(r);o.a},d4bd:function(e,t,n){"use strict";n.d(t,"a",function(){return r});const r={data(){return{isShow:1}},methods:{show(e){1===e&&1!==this.isShow?this.isShow=1:this.isShow=0}}}},d5f6:function(e,t,n){"use strict";var r=n("d872"),o=n.n(r);o.a},d872:function(e,t,n){}});
//# sourceMappingURL=app.b2a5a1ed.js.map