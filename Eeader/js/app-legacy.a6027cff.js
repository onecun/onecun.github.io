(function(e){function t(t){for(var r,a,c=t[0],s=t[1],u=t[2],l=0,f=[];l<c.length;l++)a=c[l],o[a]&&f.push(o[a][0]),o[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);d&&d(t);while(f.length)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={app:0},o={app:0},i=[];function c(e){return s.p+"js/"+({}[e]||e)+"-legacy."+{"chunk-002e499f":"bfe42d39","chunk-dbba60c4":"2eefaf27"}[e]+".js"}function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n={"chunk-002e499f":1,"chunk-dbba60c4":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise(function(t,n){for(var r="css/"+({}[e]||e)+"."+{"chunk-002e499f":"6ae90ab5","chunk-dbba60c4":"a99cfebc"}[e]+".css",o=s.p+r,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var u=i[c],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===r||l===o))return t()}var f=document.getElementsByTagName("style");for(c=0;c<f.length;c++){u=f[c],l=u.getAttribute("data-href");if(l===r||l===o)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var r=t&&t.target&&t.target.src||o,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=r,delete a[e],d.parentNode.removeChild(d),n(i)},d.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(d)}).then(function(){a[e]=0}));var r=o[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise(function(t,n){r=o[e]=[t,n]});t.push(r[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,s.nc&&l.setAttribute("nonce",s.nc),l.src=c(e),u=function(t){l.onerror=l.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+r+": "+a+")");i.type=r,i.request=a,n[1](i)}o[e]=void 0}};var f=setTimeout(function(){u({type:"timeout",target:l})},12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var f=0;f<u.length;f++)t(u[f]);var d=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0e6c":function(e,t,n){"use strict";var r=n("103e"),a=n.n(r);a.a},"103e":function(e,t,n){},"1b8f":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r,a,o,i,c,s=n("8bbf"),u=n.n(s),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("keep-alive",[n("router-view")],1)],1)},f=[],d=n("2877"),p={},h=Object(d["a"])(p,l,f,!1,null,null,null),m=h.exports,b=n("6389"),v=n.n(b),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("SidebarBookShelf"),n("BookShelf")],1)},k=[],x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"book-shelf-wrapper"},[e._l(e.bookList,function(t,r){return n("div",{key:r,staticClass:"book-item",on:{click:function(n){return e.jumpTo(t.bookname)}}},[n("div",{staticClass:"book-cover",domProps:{innerHTML:e._s(t.cover)}}),n("div",{staticClass:"book-name"},[e._v(e._s(t.bookname))])])}),n("div",{staticClass:"add-book",on:{click:function(t){return e.addBook()}}},[n("div",{staticClass:"add-book-img"},[n("div",{staticClass:"add-book-img-svg"},[n("svg",{staticClass:"icon",attrs:{t:"1563699280848",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"9282","data-spm-anchor-id":"a313x.7781069.0.i4",width:"200",height:"200"}},[n("path",{attrs:{d:"M903 558.2c-13.3 0-24 10.7-24 24v216.7c0 16.8-16.1 30.4-36 30.4H181c-19.9 0-36-13.6-36-30.4V561.3c0-13.3-10.7-24-24-24s-24 10.7-24 24v237.6c0 43.2 37.7 78.4 84 78.4h662c46.3 0 84-35.2 84-78.4V582.2c0-13.3-10.7-24-24-24z",fill:"#AAAAAA","p-id":"9283"}}),n("path",{attrs:{d:"M334.5 298.6l160.9-145.3c1.1-1 2.3-1.9 3.6-2.7h0.1c0.6-0.4 1.2-0.7 1.9-1 0 0 0.1 0 0.1-0.1 0.6-0.3 1.3-0.6 1.9-0.8 0 0 0.1 0 0.1-0.1 0.6-0.2 1.3-0.4 1.9-0.6h0.2c0.6-0.2 1.3-0.3 1.9-0.4h0.2c0.6-0.1 1.3-0.2 2-0.3h0.2c0.7-0.1 1.3-0.1 2-0.1h0.2c0.6 0 1.3 0 1.9 0.1h0.3c0.7 0.1 1.3 0.2 2 0.3h0.2c0.7 0.1 1.3 0.3 2 0.5h0.1c0.7 0.2 1.3 0.4 2 0.7h0.1c0.7 0.3 1.3 0.5 2 0.9 1.3 0.7 2.6 1.4 3.8 2.3 0.6 0.5 1.2 0.9 1.7 1.4l158.6 145.3c9.8 9 10.4 24.1 1.5 33.9-9 9.8-24.1 10.4-33.9 1.5L535.1 225.3l-3 467.2c-0.1 13.2-10.8 23.8-24 23.8h-0.2c-13.3-0.1-23.9-10.9-23.8-24.2l3-466.7-120.4 108.8c-9.8 8.9-25 8.1-33.9-1.7-8.9-9.8-8.1-25 1.7-33.9z",fill:"#AAAAAA","p-id":"9284"}})])])]),n("div",{staticClass:"add-book-text"},[e._v("添加图书")]),n("input",{ref:"input",staticClass:"input",attrs:{type:"file"},on:{change:function(t){return e.loadFile(t)}}})])],2)},w=[],y=(n("7f7f"),n("28a5"),n("a481"),n("96cf"),n("3b8d")),S=new DOMParser,j=new JSZip,C=[],A=[],O=function(e){var t=e.split(".");return t[t.length-1]},_=function(e){return""===o?e:o+"/"+e},N=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j.loadAsync(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:return r=e.sent,e.next=5,r.files["META-INF/container.xml"].async("string");case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){var n,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,B(t);case 2:return n=e.sent,i=S.parseFromString(n,"text/xml"),a=i.getElementsByTagName("rootfile")[0].getAttribute("full-path"),o="content.opf"===a.split("/")[0]?"":a.split("/")[0],e.next=8,r.files[a].async("string");case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,o,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,L(t);case 2:for(n=e.sent,i=S.parseFromString(n,"text/xml"),c=i.getElementsByTagName("spine")[0].children,r=[],a=0;a<c.length;a++)o=c[a].getAttribute("idref"),s=i.getElementById(o).getAttribute("href"),r.push(s);return e.abrupt("return",r);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){var n,a,o,i,c,s,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,T(t);case 2:n=e.sent,a=[],o=n.length,i=0;case 6:if(!(i<o)){e.next=17;break}return c=n[i],s=_(c),e.next=11,r.files[s].async("string");case 11:u=e.sent,C.push(s),a.push(u);case 14:i++,e.next=6;break;case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){var n,a,o,i,c,s,u,l,f,d,p,h,m,b;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return R(),n=function(){var e=Object(y["a"])(regeneratorRuntime.mark(function e(t){var n,a,o,i,c,s,u,l,f,d,p,h,m,b,v;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=S,e.next=3,t;case 3:e.t1=e.sent,n=e.t0.parseFromString.call(e.t0,e.t1,"text/html"),a=n.getElementsByTagName("image"),[],o=0;case 8:if(!(o<a.length)){e.next=20;break}return i=a[o],c=i.getAttribute("xlink:href"),s=O(c),u=_(c).replace(/\/\.\.\//,"/"),e.next=15,r.files[u].async("base64");case 15:l=e.sent,i.setAttribute("xlink:href","data:image/"+s+";base64,"+l);case 17:o++,e.next=8;break;case 20:f=n.getElementsByTagName("img"),d=0;case 22:if(!(d<f.length)){e.next=34;break}return p=f[d],h=p.getAttribute("src"),m=O(h),b=_(h).replace(/\/\.\.\//,"/"),e.next=29,r.files[b].async("base64");case 29:v=e.sent,p.setAttribute("src","data:image/"+m+";base64,"+v);case 31:d++,e.next=22;break;case 34:return e.abrupt("return",n);case 35:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.next=4,E(t);case 4:a=e.sent,o=[],i=a.length,c=0;case 8:if(!(c<i)){e.next=17;break}return s=a[c],e.next=12,n(s);case 12:u=e.sent,o.push({relativeurl:C[c],content:"".concat(u.querySelector("body").innerHTML)});case 14:c++,e.next=8;break;case 17:return l=_("toc.ncx"),e.next=20,r.files[l].async("string");case 20:for(f=e.sent,d=S.parseFromString(f,"text/xml"),A=d.querySelectorAll("navPoint"),p=[],h=0;h<A.length;h++)m="".concat(A[h].querySelector("text").innerHTML),b=_("".concat(A[h].querySelector("content").getAttribute("src"))).split("#")[0],p.push({secName:m,sectionUrl:b});return e.abrupt("return",[o,p]);case 26:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),R=function(){r=void 0,a=void 0,o=void 0,i=void 0,c=void 0,C=[]},D=P,M=n("5a72"),$={clearLocal:function(){localStorage.clear()},getLocal:function(){var e=localStorage.getItem("books");return e?JSON.parse(e):[]},saveLocal:function(e){this.clearLocal(),localStorage.setItem("books",JSON.stringify(e))}},q={methods:{jumpTo:function(e){this.$router.push({name:"reader",params:{bookname:e},query:{section:1}})}}},F={mixins:[q],data:function(){return{currBlob:"",currDbName:"",booksName:[]}},computed:{bookList:function(){return this.$store.state.booklist}},methods:{addBook:function(){this.$refs.input.click()},loadFile:function(e){var t=this;if(!(e.target.files.length<1)){this.currBlob=e.target.files[0],this.currDbName=this.currBlob.name.split(".")[0];var n=Object(M["b"])(this.currDbName);this.booksName.push(this.currDbName),n.then(function(e){"first-open"===e?D(t.currBlob).then(function(e){var n=e[1];M["a"].add(t.currDbName,n,0);for(var r=e[0],a=r.length,o=0;o<a;o++){var i=r[o];M["a"].add(t.currDbName,i,o+1)}}).then(function(){t.getCover(),t.localSave()}):"open"===e&&(t.getCover(),t.localSave())})}},getCover:function(e){var t,n=this;t=void 0===e?[this.currDbName]:e;var r=1;M["a"].read(t,r).then(function(e){var r={};r.bookname=t,r.cover=e.content,n.$store.commit("addbook",r)})},localSave:function(){$.saveLocal(this.booksName)}},mounted:function(){var e=this,t=$.getLocal();this.booksName=t,t.length>=1&&t.map(function(t){Object(M["b"])(t).then(function(){e.getCover(t)})})}},I=F,H=(n("8c34"),Object(d["a"])(I,x,w,!1,null,null,null)),J=H.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("aside",{staticClass:"sidebar"},[n("header",{staticClass:"sidebar-item-title",on:{click:function(t){return t.target!==t.currentTarget?null:e.show(1)}}},[e._v("书架")]),n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.isShow,expression:"isShow === 1"}],staticClass:"book-shelf-small"},e._l(e.bookList,function(t,r){return n("div",{key:r,staticClass:"sidebar-item-book"},[n("div",{staticClass:"sidebar-book-name sidebar-collapse-item",on:{click:function(n){return e.jumpTo(t.bookname)}}},[e._v(e._s(t.bookname))])])}),0)])},U=[],z=n("d4bd"),K={mixins:[q,z["a"]],computed:{bookList:function(){return this.$store.state.booklist}}},Z=K,G=(n("d5f6"),Object(d["a"])(Z,V,U,!1,null,null,null)),Q=G.exports,W={name:"home",components:{BookShelf:J,SidebarBookShelf:Q}},X=W,Y=(n("0e6c"),Object(d["a"])(X,g,k,!1,null,null,null)),ee=Y.exports;u.a.use(v.a);var te=new v.a({routes:[{path:"/",name:"home",component:ee},{path:"/reader/:bookname",name:"reader",component:function(){return n.e("chunk-002e499f").then(n.bind(null,"968f"))}}],scrollBehavior:function(e,t,n){return n||{x:0,y:0}}}),ne=n("5880"),re=n.n(ne);u.a.use(re.a);var ae=new re.a.Store({state:{booklist:[],secList:[],readerCurrContentUrl:""},mutations:{addbook:function(e,t){e.booklist.push(t)},addsec:function(e,t){e.secList.push(t)},changeurl:function(e,t){e.readerCurrContentUrl=t}},actions:{}});u.a.config.productionTip=!1,new u.a({router:te,store:ae,render:function(e){return e(m)}}).$mount("#app")},5880:function(e,t){e.exports=Vuex},"5a72":function(e,t,n){"use strict";var r;n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o});var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n,a){var o=window.indexedDB.open(e,t);o.onerror=function(e){a("数据库打开失败")},o.onsuccess=function(e){r=o.result,n("open")},o.onupgradeneeded=function(t){r=t.target.result;var a=r.createObjectStore(e,{keyPath:"id"});a.createIndex("relativeurl","relativeurl",{unique:!0}),a.createIndex("section","section",{unique:!0}),a.createIndex("content","content"),n("first-open")}})},o={add:function(e,t,n){return new Promise(function(a,o){var i=r.transaction([e],"readwrite"),c=i.objectStore(e);t.id=n,t.section=n;var s=c.add(t);s.onsuccess=function(e){a()},s.onerror=function(e){o()}})},read:function(e,t){return new Promise(function(n,a){var o=r.transaction([e]),i=o.objectStore(e),c=i.get(t);c.onsuccess=function(e){n(e.target.result)},c.onerror=function(e){a("读取失败")}})},indexRead:function(e,t){return new Promise(function(n,a){var o=r.transaction([e]),i=o.objectStore(e),c=i.index("relativeurl"),s=c.get(t);s.onsuccess=function(e){n(e.target.result)},s.onerror=function(e){a("读取失败")}})}}},6389:function(e,t){e.exports=VueRouter},"8bbf":function(e,t){e.exports=Vue},"8c34":function(e,t,n){"use strict";var r=n("1b8f"),a=n.n(r);a.a},d4bd:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={data:function(){return{isShow:1}},methods:{show:function(e){1===e&&1!==this.isShow?this.isShow=1:this.isShow=0}}}},d5f6:function(e,t,n){"use strict";var r=n("d872"),a=n.n(r);a.a},d872:function(e,t,n){}});
//# sourceMappingURL=app-legacy.a6027cff.js.map